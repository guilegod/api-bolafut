generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  user
  owner        // organizador
  arena_owner  // dono de arena/estabelecimento
  admin
}

enum CourtType {
  FUTSAL
  FUT7
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(user)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // arenas de um arena_owner
  courts Court[] @relation("ArenaOwnerCourts")

  // partidas criadas por organizador
  matches Match[] @relation("OrganizerMatches")

  // parcerias do organizador com arenas
  partnerships PartnerArena[] @relation("OrganizerPartnerships")

  // presenças do usuário nas partidas
  presences MatchPresence[]
}

model Court {
  id        String    @id @default(cuid())
  name      String
  type      CourtType @default(FUTSAL)

  city      String?
  address   String?

  arenaOwnerId String?
  arenaOwner   User? @relation("ArenaOwnerCourts", fields: [arenaOwnerId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  matches      Match[]
  partnerships PartnerArena[]
}

model PartnerArena {
  id          String   @id @default(cuid())
  organizerId String
  courtId     String

  organizer User  @relation("OrganizerPartnerships", fields: [organizerId], references: [id])
  court     Court @relation(fields: [courtId], references: [id])

  createdAt DateTime @default(now())

  @@unique([organizerId, courtId])
}

model Match {
  id            String   @id @default(cuid())
  title         String
  date          DateTime

  organizerId   String
  organizer     User     @relation("OrganizerMatches", fields: [organizerId], references: [id])

  // ✅ pode ser null (match manual)
  courtId       String?
  court         Court?   @relation(fields: [courtId], references: [id])

  type          CourtType @default(FUTSAL)
  matchAddress  String?

  maxPlayers     Int      @default(14)
  pricePerPlayer Int      @default(30)

  // ✅ cancelamento
  isCanceled     Boolean  @default(false)
  canceledAt     DateTime?

  presences MatchPresence[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MatchPresence {
  id        String   @id @default(cuid())
  userId    String
  matchId   String
  createdAt DateTime @default(now())

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  match Match @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@unique([userId, matchId])
  @@index([matchId])
}
